<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    {% load compress static %}
    {% compress css %}
        <link rel="stylesheet" type="text/x-scss" href="{% static 'core/homepage/home-header-style.scss' %}">
        <link rel="stylesheet" type="text/x-scss"
              href="{% static 'core/profile-view-styles/profile-tabs-views/account-payments-styles.scss' %}">
    {% endcompress %}

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: "Euclid Circular A", sans-serif;
        }

        p, a {
            font-weight: 500;
            font-size: 1em;
            font-style: normal;
            color: black;
        }

        #main-payment-content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
    </style>
    <title>Account payments Tab</title>
</head>
<body>
{% include 'template-components/header-comp.html' %}

<h1>{{ user.get_full_name|default:user.username }}'s Payment History</h1>

<main id="main-payment-content">
    {% if payment_details %}
        <div class="payment-columns-container">
            <!-- Bookings Column -->
            <div class="payment-column">
                <h2 class="payment-column-title">Bookings</h2>
                {% for payment in payment_details %}
                    {% if payment.type == 'booking' %}
                        <div class="payment-card">
                            <div class="payment-header">
                                <div>
                                    <span class="payment-type booking">Booking</span>
                                    <h3>{{ payment.record.service.title }}</h3>
                                </div>
                                <span class="payment-status {% if payment.status == 'paid' %}paid{% endif %}">
                                    {{ payment.status|default:"N/A"|title }}
                                </span>
                            </div>

                            <div class="payment-details">
                                <div>
                                    <p><strong>Amount:</strong> {{ payment.amount_paid|default:"N/A" }}</p>
                                    <p><strong>Date:</strong> {{ payment.date_paid|date:"M d, Y H:i" }}</p>
                                    <p><strong>ID:</strong> {{ payment.record.id }}</p>
                                </div>
                                <div>
                                    <p><strong>Provider:</strong> {{ payment.record.provider.get_full_name }}</p>
                                    <p>
                                        <strong>Appointment:</strong> {{ payment.record.appointment_datetime|date:"M d, Y H:i" }}
                                    </p>
                                    <p><strong>Service:</strong> {{ payment.record.service.title }}</p>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% empty %}
                    <p class="no-payments">No booking records found.</p>
                {% endfor %}
            </div>

            <!-- Subscriptions Column -->
            <div class="payment-column">
                <h2 class="payment-column-title">Subscriptions</h2>
                {% for payment in payment_details %}
                    {% if payment.type == 'subscription' %}
                        <div class="payment-card">
                            <div class="payment-header">
                                <div>
                                    <span class="payment-type subscription">Subscription</span>
                                    <h3>{{ payment.record.get_plan_display }} Plan</h3>
                                </div>
                                <span class="payment-status {% if payment.status == 'paid' %}paid{% endif %}">
                                    {{ payment.status|default:"N/A"|title }}
                                </span>
                            </div>

                            <div class="payment-details">
                                <div>
                                    <p><strong>Amount:</strong> {{ payment.amount_paid|default:"N/A" }}</p>
                                    <p><strong>Date:</strong> {{ payment.date_paid|date:"M d, Y" }}</p>
                                    <p><strong>ID:</strong> {{ payment.record.id }}</p>
                                </div>
                                <div>
                                    <p><strong>Period
                                        Start:</strong> {{ payment.record.current_period_start|date:"M d, Y" }}</p>
                                    <p><strong>Period
                                        End:</strong> {{ payment.record.current_period_end|date:"M d, Y" }}</p>
                                    <p><strong>Auto-renew:</strong> {% if payment.record.cancel_at_period_end %}
                                        No{% else %}Yes{% endif %}</p>
                                </div>
                            </div>

                            <div class="receipt-buttons">
                                {% if payment.receipt_url %}
                                    <a href="{{ payment.receipt_url }}" target="_blank" rel="noopener noreferrer"
                                       class="receipt-btn">
                                        View Receipt Online
                                    </a>
                                {% endif %}
                                {% if payment.pdf_url %}
                                    <a href="{{ payment.pdf_url }}" download class="receipt-btn">
                                        Download PDF Receipt
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% empty %}
                    <p class="no-payments">No subscription records found.</p>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <p class="no-payments">No payment records found.</p>
    {% endif %}
</main>
<script src="{% static 'js-scripts/home-side-panel.js' %}"></script>
</body>
</html>